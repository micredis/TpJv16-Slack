Grigory Kislin [9:16 PM]
joined #hw2.

Grigory Kislin [9:19 PM]
Доброго еще вечера!
Второе занятие Topjava: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson02.md
Занятие объемное, сложное и важное. Пугаться не надо- делаем все последовательно.
Все подводные камни разжеваны максимально, читаем внимательно.
Успехов в выполнении! Рассылка по почте будет днем. (edited) 

Dima [9:23 PM]
joined #hw2 along with 18 others.


IgorPetrov   [Feb 14th at 6:01 PM]
Подскажите плз! Идея не воспринимает  <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib prefix="fn" uri="http://topjava.javawebinar.ru/functions" %> подчеркивает красным http и при наведении говорит что ожидается statement а получил http Предлагает отключить проверку. Что ожидается? Что не так?
oracle.com
Oracle Technology Network for Java Developers | Oracle Technology Network | Oracle
Oracle Technology Network is the ultimate, complete, and authoritative source of technical information and learning about Java.
oracle.com
Oracle Technology Network for Java Developers | Oracle Technology Network | Oracle
Oracle Technology Network is the ultimate, complete, and authoritative source of technical information and learning about Java.
3 replies

Grigory Kislin   [2 months ago]
через Alt+F1  - не решается? IDEA не закачивает что ей требуется? (edited)

Yuriy   [2 months ago]
Покажи, что в помник по JSTL добавил

IgorPetrov   [2 months ago]
Пробую через  Alt+enter   предлагается configure data sourse, Edit Derby fragment , remove attribute ,  un inject Languare, Не знаю как решать. Через Alt+F1 у меня помойму не то  (выбор окон).   В помнике <dependency>
           <groupId>org.slf4j</groupId>
           <artifactId>slf4j-api</artifactId>
           <version>${slf4j.version}</version>
           <scope>compile</scope> <!--// war-->
       </dependency>

       <dependency>
           <groupId>org.slf4j</groupId>
           <artifactId>jcl-over-slf4j</artifactId>
           <version>${slf4j.version}</version>
           <scope>runtime</scope>
       </dependency>      <dependency>
           <groupId>javax.servlet</groupId>
           <artifactId>jstl</artifactId>
           <version>1.2</version>
       </dependency>
   </dependencies> (edited)
   
   
Denis Volkov   [Feb 14th at 6:16 PM]
Привет. Надо ли учитывать уникальность User.name или User.email? (что будет логином?) Или пока никак не учитывать, т.к. авторизация будет другая?
3 replies

ILYA   [2 months ago]
Пока не заморачивайся, потом все исправиться

Grigory Kislin   [2 months ago]
уникальность будет по email. прикрутим, когда база будет, сейчас не надо

Denis Volkov   [2 months ago]
Ок, спасибо.


andrei.rusu   [Feb 16th at 3:51 PM]
tomcat 8.5 или 9.0?
1 reply

makushatnik   [1 month ago]
Учитывая что в больш-ве компаний стоит 8, уверен, что он подойдет.


pr1zrak   [Feb 16th at 4:58 PM]
Добрый день! А еда, которая у нас есть сейчас, она же ни к какому юзеру не прикреплена
9 replies

ILYA   [1 month ago]
И тебе надо дз сделать чтобы была прикреплена к юзеру

pr1zrak   [1 month ago]
к любому?

pr1zrak   [1 month ago]
я про то что это список еды одного юзера? или трех? пяти?

Grigory Kislin   [1 month ago]
@pr1zrak демку смотрел?? (edited)

pr1zrak   [1 month ago]
Которая на хероку выложена? Да

pr1zrak   [1 month ago]
в ней админ видит всю еду, как я понимаю, юзер - только свою

ILYA   [1 month ago]
@pr1zrak и тебе надо модифицировать Мапу так чтобы юзер мог видеть и редактировать только свою еду

Oleg   [1 month ago]
@pr1zrak Админ видит только свою еду.

Grigory Kislin   [1 month ago]
каждый- свою еду.


dancelikefish   [Feb 16th at 5:38 PM]
Ребят подскажите правильно ли я понимаю, если я хочу конвертить Meal в DTO на слое service , означает ли это, что методы getFilteredWithExcess должны быть зарефакторены под работу с MealTo? Ведь вызов метода будет происходить в контроллере, куда уже придут MealsTO
5 replies

makushatnik   [1 month ago]
А что такое MealTo? Разве не DTO? Нафига еще 1 DTO? Чтобы самого себя запутать? Чтобы работа не была слишком простой?

dancelikefish   [1 month ago]
MealTo и есть DTO, я про это и говорю.
Вопрос в том, что конвертируя Meal в MealTo на слое service в контроллер будут попадать не Meal а MealTO,   где в последствии нужно будет вызывать метод фильтрации, при этом метод фильтрации принимает параметры Meal.

ILYA   [1 month ago]
@dancelikefish так конвертируй в контроллере. Ты же необязательно должен dto именно в слое сервис делать

Grigory Kislin   [1 month ago]
@dancelikefish если делаешь в сервисе- оттуда и вызываешь MealUtil (edited)

makushatnik   [1 month ago]
Да, правильную архитектуру продумывает сам разраб. Если надо, меняет. Никто не подскажет, как правильно ее сделать.


makushatnik   [Feb 16th at 6:11 PM]
Ну что, кто разобрался со Спрингом?) Разобраться со Спрингом и не сойти с ума - mission impossible)
16 replies

Valeriy   [1 month ago]
Смотрю видосы что в ссылках к уроку, пытаюсь вникнуть

John   [1 month ago]
Видео докладов Борисова и тому подобные не для новичков в спринге. Не знаю насколько часто используется донастройка бинов или фабрики, я бы не дал больше 7%. На udemy курс Чада Дерби - самое то для начинающего.

Grigory Kislin   [1 month ago]
@makushatnik вопросы формулируй

German_lbt   [1 month ago]
Борисов - молодцом! мне ндравится потрошитель, много раз смотрел все части...сразу спринг тоже не вошел...его нужно не торопясь курить....)))

Bahis   [1 month ago]
вкурить бы коррекно ТЗ по ДЗ )

John   [1 month ago]
@German_lbt, а полученную информацию от Борисова доводилось применять в продакшне? Мне просто интересно в каких случаях это реально востребовано.

German_lbt   [1 month ago]
а вот как раз в продакшине и нужно...профайлинг(профилирование)...рефлексия...вот нельзя стопать продукт...а прикрутить надо чего-нить (edited)

makushatnik   [1 month ago]
Я начинал изучать его по "Спринг 4", потом по "Spring in Action", потом на проекте, а потом попал на javaops.

makushatnik   [1 month ago]
Самостоятельно разбирать его сложно)

Nikita Krutov   [1 month ago]
На мой взгляд Борисов вообще не подходит для изучения спринга - всё слишком специфично и рассчитано что у вас уже много опыта, тут надо смотреть базовые уроки...

pr1zrak   [1 month ago]
Spring in Action стоит читать? полезная?

John   [1 month ago]
Слышал, что 'in action' для более продвинутого уровня, сам не смотрел. Читаю 'Pro spring'. Пробовал так же спринговую доку - заходит если что-то конкретное надо понять. Если читать просто как художку - не вариант.

pr1zrak   [1 month ago]
а что за книга “Pro Spring”? Электронная версия есть? Бесплатная :slightly_smiling_face:

Nikita Krutov   [1 month ago]
хорошую книжку выкладывали на одном из каналов здесь. "Все паттерны проектирования Spring". Читаю сейчас её - всё хорошо по полочкам разложено.

pr1zrak   [1 month ago]
да тоже скачал ее )

makushatnik   [1 month ago]
Spring in Action полезная) Читать ее легче, чем "Spring 4". 1-я практическая, во 2й много всяких сложных терминов - теория, а потом немного практики.


Yuriy Podobed   [Feb 16th at 9:31 PM]
4: Проверку isBetweenDate сделать в DateTimeUtil. Попробуйте использовать дженерики и объединить ее с isBetweenTime. Не въехал в формулировку. Нужно в одном методе сделать проверку на Date и Time одновременно или обобщить метод  <T extends Comparable<T>> boolean isBetweenDate...
4 replies

John   [1 month ago]
Скорее всего второе - сделать метод, принимающие три параметра одного типа и проверяющий что значение одного из аргументов между значениями двух других

Dmitry   [1 month ago]
а почему extends Comparable? я ж тогда могу передать 3 Integer например, и ошибка не подсветится, а сравнение - не то.

John   [1 month ago]
Integer реализует Comparable потому и не будет ошибки. Почему сравнение не то?


Dmitry   [1 month ago]
Так в DateTimeUtil мы с датами хотим работать, а если туда попало что-то ещё - неплохо бы об этом узнать заранее.


makushatnik [11:30 PM]
Пункты 5.1 и 5.7 пояснения к ДЗ - одно и тоже. (edited) 


Story   [Feb 17th at 12:08 AM]
Надо ли делать кнопку отмены фильтрации? или это потом
3 replies

Alexander   [1 month ago]
кнопку отмены фильтрации делать не надо

makushatnik   [1 month ago]
Очистка полей - это и есть отмена фильтрации.

Grigory Kislin   [1 month ago]
потом сделаем


makushatnik   [Feb 17th at 1:26 AM]
П. 6 задания не выполняется без изменения pom. Т.к. нужный для выполнения задания контекст находится в пакете web, не подключенном в pom.xml.
4 replies

Tanya   [1 month ago]
в задании явно указано
pom.xml НЕ менять, работаем со *spring-context*
см SpringMain (edited)

makushatnik   [1 month ago]
Да, работает и с обычным контекстом. Хотя web'овский наверное больше подходит.

Konstantin Shishin   [1 month ago]
А как именно получилось инициализировать контекст без org.springframework.web?
В пакете org.springframework.context подходящий Listener не могу найти.
Инициализировать в методе init() сервлета с помощью ClassPathXmlApplicationContext тоже не получается.

Konstantin Shishin   [1 month ago]
Получилось через init(), видимо проблема в Tomcat была.


pr1zrak   [Feb 17th at 2:43 PM]
Всем добрый день, есть уже те, кто сделал второе задание? (edited)
2 replies

tolik1106   [1 month ago]
Да,  но не optional. И без проверки.

Nikita Krutov   [1 month ago]
сделал пока без optional


Petr Kreslin   [Feb 17th at 3:19 PM]
мозг себе сломал в п.3.1: "ИЛИ без него (как нравится)" --намекните, как ещё может реализовываться привязка еды к пользователю в рамках задания? что я упустил?
7 replies

Petr Kreslin   [1 month ago]
1. хранить список Id еды в юзере?
2. создать таблицу мэпингна юзер-еда? (ничем не отличается от Id юзера в еде и сожрёт память)
3. ещё можно создавать новую таблицу еды для каждого юзера :slightly_smiling_face: я видел такие реализации, возможно, не лишены смысла в плане производительности бд

Max   [1 month ago]
Лично я сделал мапу в которой ключ - это id юзера, а значения - это мапы с едой: Map<Integer, Map<Integer, Meal>>

Max   [1 month ago]
И с удалением юзера проблем не будет, по его id удалится из репозитория и его мапа с едой

Petr Kreslin   [1 month ago]
а где ты эту мапу хранишь? её ведь тоже тогде нужно в БД сохранить как таблицу и повторить всю пляску с бубном, как для еды и юзеров? если это ок и так делают, ну ок, буду знать )) или я чего-то опять не понял..?

Max   [1 month ago]
Ну, мы же до бд еще не добрались, для реализации хранения в памяти мне такой способ показался удобным. А вот когда будет бд и будет две таблицы для юзеров и для еды, тогда нет никаких проблем просто добавить поле с id юзера в Meal, на старую реализацию хранения в памяти это вообще не повлияет. (edited)

Grigory Kislin   [1 month ago]
@Petr Kreslin мы пока НЕ работаем с БД, только в памяти

Yuriy   [1 month ago]
Можно еще композитный ключ сделать. Что-то вроде Map<Pair<Integer, Integer>, Meal>


pr1zrak [3:20 PM]
я думаю там просто не нужно было писать “или без него”

Petr Kreslin [3:25 PM]
ещё я не понимаю, как можно взять и удалить пользователя. Его еду мы себе на память оставляем? или потом напишем триггер на удаление в БД?


pr1zrak   [Feb 17th at 3:25 PM]
она удалится вместе с удалением пользователя поидее
7 replies

Petr Kreslin   [1 month ago]
на самом деле, у юзера должно быть поле boolean active и его нужно изменять. удалять мастер данные из   бд неблагодарное занятие, особенно когда таблица еды разрастётся

pr1zrak   [1 month ago]
я когда делал примеры из интернета и через hibernate работал с базой

pr1zrak   [1 month ago]
там все хитро настраивалось

pr1zrak   [1 month ago]
и после удаления юзера, удалялись его автомобили

Petr Kreslin   [1 month ago]
ну короче, в жизни так не делай )

Petr Kreslin   [1 month ago]
ещё лучше, если это поле будет enum state, и у него несколько возможных состояний: проект, активный, деактивированный, замороженный за неоплату  и ещё какой-нибудь

makushatnik   [1 month ago]
Оба подхода верны. Иногда нужно все полностью удалить.


pr1zrak [3:25 PM]
когда мы это реализуем

pr1zrak [3:32 PM]
кто может сказать, как лучше логгер создавать? есть 2 варианта


pr1zrak   [Feb 17th at 3:32 PM]
1. private static final Logger log = LoggerFactory.getLogger(InMemoryUserRepositoryImpl.class);
3 replies

makushatnik   [1 month ago]
2 вариант - универсальный. Это знчт, что ты можешь скопировать куда-то эту строку (или в шаблон идеи) и вставлять в любой класс.

pr1zrak   [1 month ago]
а если экземпляр класса создается многократно, например если логировать класс User

pr1zrak   [1 month ago]
то луше статический логгер же?


pr1zrak [3:32 PM]
2. private final Logger log = LoggerFactory.getLogger(getClass());


pr1zrak   [Feb 17th at 3:33 PM]
просто в контроллерах он создан не статически
1 reply

makushatnik   [1 month ago]
не статически - не правильно вообще. могут быть ошибки.


pr1zrak [3:33 PM]
а в юзеррепозитории статически


DmitrIY Stakhanov   [Feb 17th at 4:14 PM]
Подскажите, пожалуйста, на каком слое фильтровать список еды по userId?
14 replies

tolik1106   [1 month ago]
Написано же SecurityUtil в слое веб

tolik1106   [1 month ago]
В контроллере

tolik1106   [1 month ago]
Пункт 4.2

DmitrIY Stakhanov   [1 month ago]
Т. е. в репозитарии мы не фильтуем еду по userId?

Andrey   [1 month ago]
На мой взгляд в репозитории, методы репозитория принимают на вход userId и   вытаскивая запрашиваемую еду из "базы"  сверяют с ним userId  еды, если не совпадает возвращают null или false, которые в следующем слое превращаются в исключения, но я могу ошибаться, т к только учучь :slightly_smiling_face:

DmitrIY Stakhanov   [1 month ago]
Я тоже так сделал, только инициализирую userId в конструкторе репозитария, в методы не передаю как параметр на вход

Story   [1 month ago]
я когда попыталась userID засунуть в конструктор, спринг стал ругаться что не может создать бин с таким конструктором. кто-нибудь знает как это обойти?

makushatnik   [1 month ago]
Не надо пытаться искать обходные пути. Надо научиться писать правильно:) В частности, то что вы делаете - извращение. Я без него обошелся.

vch   [1 month ago]
Чисто ради любопытства... У вас на каждого пользователя по отдельному экземпляру репозитория создаётся?

Story   [1 month ago]
нет

makushatnik   [1 month ago]
Тоже глупости какие-то. Репозиторий 1. Можно сравнить с библиотекой. Вы приходите и говорите - Мне нужна "Такая-то Книга". Либо все книги "Такого-то Автора".


John   [1 month ago]
про userId в конструкторе - сказали же так не делать, так как при переходе на sql db этот функционал придется удалять

DmitrIY Stakhanov   [1 month ago]
Переделал

Grigory Kislin   [1 month ago]
когда реализуем интерфейс, имеем в виду, что в итоге это все будет хранится в базе данных. тогда (надеюсь) ответ очевиден


pr1zrak   [Feb 17th at 6:09 PM]
на HW0 нас было 310 человек, на HW2 уже 115, где остальные?
7 replies

makushatnik   [1 month ago]
Принесли в жертву:)

DmitrIY Stakhanov   [1 month ago]
#HW0 был бесплатным

pr1zrak   [1 month ago]
все равно непонятно, hw1 было 173

pr1zrak   [1 month ago]
до hw10 доживут не все?

Max   [1 month ago]
Ну, во-первых, прошло только пол недели, возможно многие до последнего тянут чтоб начать задание делать. Во-вторых, подключение к каналу нужно для обсуждения, а само задание и так можно получить по ссылке. Если нечего человеку спросить ему не обязательно и к каналу подключаться (edited)

Yevhen Maksymovych   [1 month ago]
Ну и плюс на хв0 много уже прошедших курс, которые просто добавляются в слаку, и хв0 по дефолту

Yevhen Maksymovych   [1 month ago]
Но, да, до хв10 доживают далеко не все


makushatnik [6:14 PM]
MealServlet стр. 36 - потенциальный NPE. Если запущу SoapUi и отправлю запрос, не указав id.
Так, так. У нас есть 1 Girl Who Codes, рассказывающая интересные истории каждый день:) (не имеющие ничего общего с реальностью:)


Bahis   [Feb 17th at 7:49 PM]
Помогите, пожалуйста, с путаницей: Мы должны сейчас только подготовить контроллер на место сервлета или уже сейчас все пустить через контроллер - сервис - репозиторий? У меня пока вроде все написано как в ТЗ, но запрос ходит по параллельному (изначальному) варианту - сервлет - репозиторий. Отсюда сложности со всеми многочисленными подпунктиками, которые описаны для варианта без сервлета. Или я что-то не понял?
9 replies

John   [1 month ago]
Не понимаю, почему контроллер не может быть сервлетом (или сервлет контроллером). К чему такое разделение? Или речь идет о каких-то конкретных классах?

Bahis   [1 month ago]
Просто к меня пока есть и то и другое... Уже можно убивать сервлет или рано?

Bahis   [1 month ago]
5.5: Сервлет мы удалим, а контроллер останется, ....

John   [1 month ago]
Удаление сервлета - это при переходе на спринг. Будет класс с другим именем, но делать будет все то же - предоставлять endpoints и реализовывать управляющую логику.

Bahis   [1 month ago]
Значит пишу и там и там.

makushatnik   [1 month ago]
Верно. Сервлет может быть и сам по себе как Контроллер (как в HW1). В данном случае нам надо сделать контроллер в сервлете. Наподобие идет работа и в самом Спринге (чрз DispatcherServlet).

makushatnik   [1 month ago]
Вам никто не будет все разжевывать, где и что нужно делать. Достаточно почитать про Спринг, какая архитектура там, и делать также. А в Спринге присутствует все, что вы перечислили.

Grigory Kislin   [1 month ago]
Optional
6. по моему все пердельно разжевано

makushatnik   [1 month ago]
Это точно)


makushatnik [8:19 PM]
По обоим заданиям у меня проблема только с computeIfPresent, computeIfAbsent, с кот-ми раньше не работал.
Хотя по сути, проблема то и небольшая - либо 2-3 строки, либо 1. Пишу по привычке чрз containsKey.

makushatnik [9:03 PM]
Об этом никто не говорил, но похоже нужно фильтры снова в request передавать. Иначе они очищаются.


Heorhii   [Feb 18th at 5:02 PM]
getByEmail в userRepo должен прокидывать NoSuchElementException если нет юзера с таким имейлом?  (через стримы делал, протестил, бросает этот експшн) Если да то как обрабатывать, если нет, то мне непонятно как устроена архитектура приложения.
10 replies

John   [1 month ago]
Обработка зависит от того где и как ты используешь этот метод. Если для авторизации, то пользователю надо сообщить, что веденные данные неверны.

ILYA   [1 month ago]
Там далее когда добавим бд. Будет нулл возвращать если не найдет. А ексепшены в слое сервис обрабатываются

John   [1 month ago]
На счет null - его везде ругают и не советуют возвращать null. Если по данному запросу в базе не нашлось никакой сущности, то лучше тут же бросить RuntimeException и потом либо в сервисе, либо в контроллере обработать.

Heorhii   [1 month ago]
в Optional к HW:
"getByEmail попробуйте сделать через stream"
вот мне стрим, пробрасывает експешн, я его ловлю и пробрасываю свой:

new NotFoundException("User with such email don't found");

Это нормально или костыль?

ILYA   [1 month ago]
@John смотри комментарии в интерфейсе UserRepository. Там четко написано  // null if not found. Мы будем возвращать нулл если не нашли, то потом в сервисе с помощью ValidationUtil будем обрабатывать этот нулл и кидать ексепшн

Heorhii   [1 month ago]
Резонно, увел все внимание на реализующий класс и не увидел комментариев в интерфейсе, спасибо.

John   [1 month ago]
@ILYA, как по мне, то это лишние действия - сперва отдавать null, а потом делать проверку на нулл и бросать исключение.

ILYA   [1 month ago]
@John ну посмотрим как дальше в проекте будет)

John   [1 month ago]
@ILYA, ты смотришь на учебный проект.  Посмотри так же что о возврате null пишут на stackoverflow, почитай Clean Code Мартина. В этом проекте если б не проверка на нул, то слой сервиса был бы вообще пуст. Ту же самую валидацию, принадлежит ли еда пользователю, может выполнить БД.

ILYA   [1 month ago]
@John как по мне репозиторий не должен кидать ексепшены. Ты либо достал оттуда еду либо не достал. А сервис где находится бизнес логика уже полученный результат обрабатывает


Александр Лауден   [Feb 18th at 6:00 PM]
userId принимать в контроллере НЕЛЬЗЯ

Что это значит? я не могу принимать входящий параметр userId?
20 replies

Grigory Kislin   [1 month ago]
именно это. почитай еще раз ДЗ почему нельзя. и видено про ДЗ пересмотри

Александр Лауден   [1 month ago]
Тогда я запутался вообще.

Александр Лауден   [1 month ago]
Как мне для каждого юзера выводить свою еду?

32xlevel   [1 month ago]
С клиента userId приходит из SecurityUtil

tolik1106   [1 month ago]
Я сделал передачу юзерИд пост запросом в ЮзерСервлет и там засетил в SecurityUtil

Александр Лауден   [1 month ago]
ОН для каждого юзера свой будет, когда несколько юзеров будет работать?

32xlevel   [1 month ago]
Будет свой

Александр Лауден   [1 month ago]
А контроллер как должен работать?

Александр Лауден   [1 month ago]
Нам сервлет использовать?

tolik1106   [1 month ago]
Для опшинол без него никак

Александр Лауден   [1 month ago]
Мне базовую часть сделать сначала.

tolik1106   [1 month ago]
Для базы нужен SpringMain

Александр Лауден   [1 month ago]
То есть, нам достаточно обращаться к классу SecurityUtil и все?

Александр Лауден   [1 month ago]
к статическому методу.

tolik1106   [1 month ago]
Да.

Александр Лауден   [1 month ago]
А когда мы веб сделаем, то мы на уровне сервлета или контроллера будет менять это значение?


tolik1106   [1 month ago]
Для проверки работы изменяешь authUserId() на другое значение (не 1)

Александр Лауден   [1 month ago]
Понятно. Спасибо.

tolik1106   [1 month ago]
Я же написал что менял в UserServlet

Grigory Kislin   [1 month ago]
в ДЗ в нескольких местах разными словами это написал. Если у вас есть вариант, как написать понятнее, буду очень благодарен


Александр Лауден   [Feb 18th at 6:27 PM]
Мультимапу можно использовать?
2 replies

ILYA   [1 month ago]
Да

Grigory Kislin   [1 month ago]
guava?


Bahis   [Feb 18th at 6:43 PM]
Застрял на фильтрах. Куда лучше сохранить их значения? В юзера?
37 replies

ILYA   [1 month ago]
Ну так же как getAll делаешь только туда ещё и в качестве параметров даты передаешь.

RamZet   [1 month ago]
2.5: Не дублируйте код в getAll и метод с фильтрацией

ILYA   [1 month ago]
@RamZet это имеется ввиду чтобы в репозитории не дублировался код в getall и в методе с фильтрацией (edited)

RamZet   [1 month ago]
ясно.... Видимо, для меня одного условие кажется переведенным с китайского (edited)

Bahis   [1 month ago]
@RamZet И какие даты передавать. Первый раз придут даты с jsp и можно вызвать метод с фильтрами. Но потом... при удаление, например, тоже метод с фильтрами вызывать? Или фильтры сбросятся? Их хранить где-то надо. И не в бинах-синглтонах притом... Где?

John   [1 month ago]
попробуй в url засунуть. такое часто в реальных сервисах встречается

Bahis   [1 month ago]
@John Засуну. Получу лист отфильтрованный. Потом обновлю страницу или удалю кого-нибудь. И фильтр слетит. Значения фильтра надо где-то хранить и подставлять после каждого обновления страницы, пока фильтры не отменишь.

John   [1 month ago]
при обновлении страницы урл не меняется, а значит а параметры в нем не исчезнут.

John   [1 month ago]
Если надо удалить запись: жмешь кнопку удаления, попадаешь в контроллер, вызываешь у сервиса метод удаления. Чтобы вернуться обратно на страницу с едой у request вызываешь метод .getHeader("referer") - он вернет урл страницы с которой ты пришел со всеми параметрами что там были. Делаешь редирект на эту же страницу.

Bahis   [1 month ago]
Спасибо большое. Я думал уже у юзера хранить...

Bahis   [1 month ago]
Все-таки что-то не так... 8.2: Не храните параметры фильтра как члены класса сервлета, это не многопоточно! Один экземпляр сервлета используется всеми запросами на сервер, попробуйте дернуть его из 2х браузеров.

Bahis   [1 month ago]
А в контроллере можно хранить? )

Bahis   [1 month ago]
Он тоже синглтон... блин

Bahis   [1 month ago]
Что-то как-то не по фэншую в url информацию о фильтрах всюду таскать..

ILYA   [1 month ago]
Ну ты через post можешь сделать и не придется в урл все запихивать

Bahis   [1 month ago]
((((((((((((((((((((((((

Bahis   [1 month ago]
А куда сохранить значения фильтра?

Bahis   [1 month ago]
сервлет и контроллер синглтоны

Bahis   [1 month ago]
потокониразунебеопасны

ILYA   [1 month ago]
Все правильно поэтому нельзя хранить значения фильтра как поля класса

Bahis   [1 month ago]
поэтому хранить только в url?

Bahis   [1 month ago]
о.. посмотрю демо. если там в url то все понятно )

ILYA   [1 month ago]
Ты же когда еду сохраняешь ты же не хранишь колличество калорий описание и дату в урл. Ты достаешь из тела запроса а не из строки урл (edited)

Bahis   [1 month ago]
еду я сохраняю в репозиторий...

Bahis   [1 month ago]
странно

John   [1 month ago]
в демке при обновлении страницы фильтр слетает

Bahis   [1 month ago]
в url demo нет филтров

Bahis   [1 month ago]
а при обновлении слеает

Bahis   [1 month ago]
)

Bahis   [1 month ago]
типо пост без сохранения, а я мучаюсь?

ILYA   [1 month ago]
Слетает потому что через пост сделано

John   [1 month ago]
Но после удаления не слетает фильтр.

John   [1 month ago]
Там аякс используется - страница частично обновляется только.

John   [1 month ago]
посему не видно урл

John   [1 month ago]
но в инспекторе видны параметры фильтра в урле http://topjava.herokuapp.com/ajax/profile/meals/filter?startDate=&endDate=&startTime=17%3A00&endTime=20%3A00

Bahis   [1 month ago]
....


Bahis   [1 month ago]
уже через пост делаю)


RamZet   [Feb 18th at 8:54 PM]
6: Проверьте корректную обработку пустых значений date и time в контроллере
что нужно? Что значит "корректная обработка" в понятии человека, выдавшего задание?  Вернуть пустой лист или заменить на Min и Max значения или бросить исключение?
2 replies

Grigory Kislin   [1 month ago]
NPE не бросаем. можно в демо посмотреть, как сделано с пустыми значениями

Story   [1 month ago]
я так понимаю, в контроллере надо установить в min/max если пустые


DmitrIY Stakhanov   [Feb 18th at 11:02 PM]
Запутался, подскажите, как с index.html передать userId в UserServlet?
6 replies

RamZet   [1 month ago]
Я сижу, над этим же думаю. Мне кажется, через форму, и в параметрах кнопки submit указать, куда передать данные. Могу бредить, если что

DmitrIY Stakhanov   [1 month ago]
Да, я тоже думаю про кнопку

DmitrIY Stakhanov   [1 month ago]
Только у формы скорее всего нужно action указать

Story   [1 month ago]
я тоже через форму сделала

DmitrIY Stakhanov   [1 month ago]
Да, сработало)

Grigory Kislin   [1 month ago]
форма+ select/option например (edited)


RamZet   [Feb 19th at 12:02 AM]
MealReastController - только один класс должен быть в пакете, без абстрактных или интерфейсов? (edited)
1 reply

Story   [1 month ago]
да


Tanya [2:52 AM]
@here
при реализации фильтрации учтите, что параметры фильтра не должны влиять на excess (см демо)


andrei.rusu   [Feb 19th at 9:26 AM]
откатился назад. Потерял все домашние задания. Начал заново все переустанавливать, но ремоте_томкат не запоскается.
9 replies

ILYA   [1 month ago]
А с гитхаба проект клонировать?

V_Gruzdev   [1 month ago]
Порт точно слушается?

Story   [1 month ago]
у меня только что не запускался томкат из за того что я запустила идею коммунити а не ультимейт:upside_down_face:

V_Gruzdev   [1 month ago]
@Story дык в комьюнити вообще нет темплейта для деплоя в томкат:slightly_smiling_face:

Grigory Kislin   [1 month ago]
>  Потерял все домашние задания
в idea есть отличная Local History по правой кнопке
часто помогает, на каталоги тоже работает

John   [1 month ago]
Для CE есть плагин от самих JB, так что можно и с СЕ деплоить.

Yuriy   [1 month ago]
последнее сообщение очень сомнительно: приложите тогда линк на тот самый плагин ОТ ДЖЕТОВ (а не от кого-то другого), с инструкцией по установке на CE

V_Gruzdev   [1 month ago]
Я только smart tomcat обнаружил.

John   [1 month ago]
https://plugins.jetbrains.com/plugin/9492-smart-tomcat
Имел ввиду, что на сайте JB, а значит одобрен JB. Не обращал внимание кто разработчик.
JetBrains Plugin Repository
Smart Tomcat - Plugins | JetBrains
Welcome to the JetBrains plugin repository


andrei.rusu   [Feb 19th at 9:27 AM]
Pasted image at 2019-02-19, 9:27 AM 
1 reply

Grigory Kislin   [1 month ago]
убей все java прцессы


Александр Лауден [4:28 PM]
Что значит отдать свою еду?
Еда юзера?


Heorhii   [Feb 19th at 4:54 PM]
Если авторизации пока нет, как мы в контроллере должны понимать кто это такой зашел на страницу и какую еду ему показывать?
Добавил в Meal - userID поле, но чтобы фильтровать еду по этому userId и выводить только его еду, нужно ж как-то юзера идентифицировать..
Кусками в голове это дело, не вижу целостную картину.

Еще вопрос, почему в userService и Controller - delete возвращает void и кидает експешн, а в meal - просто возвращает boolean. Разве не должна быть какая-то одна парадигма работы методов если они суть делают одно и тоже только с разными объектами? (edited)
10 replies

Story   [1 month ago]
4.1 ... id авторизованного юзера можно получить из SecurityUtil.authUserId()

Heorhii   [1 month ago]
Могу я из SecurityUtil.authUserId() вытащить UserId в jsp файле?

Так пробую:
<input type="hidden" name="userId" value="<%  ru.javawebinar.topjava.web.SecurityUtil.authUserId(); %>">

толку 0, в контроллер пустой String приходит (edited)

Heorhii   [1 month ago]
Захардкодил и в jsp и в SecurityUtil.authUserId() единицу, так-то работает, но не красиво это как-то.

Heorhii   [1 month ago]
Все таки сделал красиво, надо было добавить функцию в functions.tld по аналогии с formatDateTime, теперь статический метод в jsp вызываю и вытягиваю idUser-a.

Grigory Kislin   [1 month ago]
@Heorhii
1. а зачем тебе в jsp authUserId?
2. еще раз поясни про delete. у нас везде void я вижу
те смотри на код, не на видео. оно не всегда актуально (edited)

Heorhii   [1 month ago]
Переключился на master branch все так же. В интерфейсах MealRepository и UserRepository delete возвращает разные значения, в 1ом - void, в 2-ом - boolean.

Я так понял надо переделать по аналогии с user как и везде, просто сбивает с толку то что в других случаях даются пустые классы, а тут метод с другой сигнатурой.

По-поводу authUserId, я не придумал как по другому из контекста в сервлете получить UserId, хардкодить одно и тоже в разных местах не хотелось, так что захардкодил magicNumber в статическом authUserId методе, и сначала в jsp сам передаю userId потом в сервлете ловлю(в форме для создания новой еды) чтобы у созданной еды было id этого юзера.

P.s. по-поводу интерфейсов, я опять клонировал проект с гита потому что наделал ужаса в идее случайно слил ветку домашки с основной, а потом не смог откатить изменения, может дело в этом. (edited)

John   [1 month ago]
@Heorhii, встраивать java код (скриплеты) в jsp страницы есть очень плохо. Отображение не должно исполнять никакого кода.

Heorhii   [1 month ago]
Перечитал сейчас еще раз задание, тут ситуация "слона то мы и не заметили", не надо userId из jsp вытаскивать оказывается.
Невнимательность это, пожалуй, мой главный недостаток.

RamZet   [1 month ago]
не только твой))))

Grigory Kislin   [1 month ago]
@Heorhii посмотрел на MealRepository из патча 2_2_HW1_optional- да, действительно `void delete(int id)`.  Ты только описывай маскимально ясно- как я сделал.
При том, что уже 16 выпуск- по поводу внимательности. Поправлю на 17 выпуске, спасибо!
у меня правится в патче 3_01_HW2_repository с ДЗ

по id- конечно мы никак не можем id авторизованного юзера в любом виде снаружи принимать (edited)


John [5:01 PM]
Выше уже обсуждалось - на странице index сделать простую форму, с инпутбоксом. При сабмите значение этого поля сохраняешь в authUserId.
Можно и просто захардкодить.


Roman   [Feb 19th at 7:20 PM]
Подскажите, значения для фильтра (startDate, startTime, endDate, endTime) нужно передавать через post метод, но у нас уже есть в сервлете метод принимающий post, который создает новый meal. Поэтому не понятно где принимать данные по фильтру, делать новый сервлет ?
3 replies

John   [1 month ago]
Не обязательно пост, любой метод сгодится. Обрабатывать так же как и создание/редактирование еды. 2 действия, но 1 метод.

Bahis   [1 month ago]
Проверяй по названию параметра на null switch или else if

Roman   [1 month ago]
понял, спасибо


German_lbt   [Feb 19th at 8:37 PM]
через springMain получаем контекст, удаляем, порождаем это понятно, при этом должны мы получать на jsp изменения? пол дня бьюсь... так понимаю инжектится надо через ServiceLocator...иль зря я это затеял?
4 replies

Bahis   [1 month ago]
я понял, что это два отдельных задания... через springmain нам не надо мучать jsp... просто консольно смотрим работу

tolik1106   [1 month ago]
В основном задании мы сервлет и jsp не трогаем, только springMain и проверяем в консоле правильность работы репозитория, сервиса и контроллера. Ну и сортировки и фильтрации

German_lbt   [1 month ago]
ну ведь голова рукам покоя не дает...хочется чтобы красиво было, по фэншую)))

tolik1106   [1 month ago]
Фэншуй будет позже наверное (edited)


IgorPetrov   [Feb 20th at 9:14 AM]
Подскажите! Я ставлю брекпоинт в mealServlet потом хочу проверить работу метода  repository.getAll(1) в строке:  request.setAttribute("meals", MealsUtil.getWithExcess(repository.getAll(1), MealsUtil.DEFAULT_CALORIES_PER_DAY));
            Я проверяю наличие в request запросе атрибута "meals" и его данных.                          А можно ли напрямую проверить работу метода в дебагере? Или нужно прописывать переменную и через нее смотреть?
2 replies

Dmitry   [1 month ago]
Параметры запроса (вкл. атрибуты) можно развернуть в дебаггере (вкладка Variables). Выполнить вычисление выражения, чтобы не сохранять во временную переменную, - evaluate (alt+f8). Если я правильно понял вопрос.
meals_servlet_get_attr_debug.png 

Grigory Kislin   [1 month ago]
Alt+F8 и любое выражение


Max [4:20 PM]
С ума сойти. Я когда неделю назад увидел задание у меня глаза на лоб полезли, пару дней не знал как подступиться даже. Оно как бы вроде ничего особо сложного, но просто слишком много всего за раз, куча пакетов появилось, куча классов, куча новых методов, много всего нового и незнакомого, в общем целая прорва возможностей где-нибудь накосячить (а я из тех людей, которые такие возможности не упускают :sweat_smile:). В итоге кое-как чего-то накодил и вроде все работало, но при этом было стойкое свербящее ощущение, что все не так, что все криво и не правильно. Был уверен, что как только посмотрю разбор дз, окажется, что я не учел миллион каких-то мелочей. И каково же было мое удивление когда оказалось, что у меня все совпадает практически 1 в 1. Доволен как слон :grin:


Max   [Feb 21st at 4:46 PM]
Единственное по поводу фильтрации вопрос возник. А почему фильтрация проходит таким сложным способом в несколько этапов, т.е. сначала используется один метод и в репозитории фильтруется по датам, потом этот список уже другим методом фильтруется по времени. А почему не сделать всю фильтрацию в одном месте? Я вот к примеру в MealsUtil в этот фильтрующий метод, который на первом занятии делали, просто добавил второй фильтр, сначала фильтруется по времени, потом следом фильтруется по дате. Вроде ж так намного проще, красивее и удобнее. Или что я не понял, объясните пожалуйста.
13 replies

ILYA   [1 month ago]
Это чтобы сумма калорий была корректная

ILYA   [1 month ago]
Потому что из репозитория если фильтровать по дате и времени сразу то день может получится обрезанным

Max   [1 month ago]
все равно не понимаю. Пол дня уже сравниваю свой вариант и эталонный, кручу, верчу, разные значения подставляю, в дэбагере смотрю. Все одинаково работает.

Andrey   [1 month ago]
Попробуй отфильтровать день в котором количество потребленных калорий превышено, ну т. е., чтобы еда вывелась красным цветом, а потом добавь еще фильтр по времени, так чтобы в таблице осталась только одна строка, если она у тебя остается красной, то все ок, если становится зеленой, то ошибка

Max   [1 month ago]
@Andrey все правильно выводится. Я потому и не понимаю в чем подвох и чего оно там так реализовано. Тот способ, которым я делал, мне кажется в разы более удобным и понятным

ILYA   [1 month ago]
@Max предположим ты ел 31 числа три раза в 10:00, в 13:00 и в 20:00. Ты ставишь  фильтр, чтобы получить еду за 31 число с 11:00 до 21:00 . В репозитории ты фильтруешь сразу по дате и времени. Тогда из репозитория достанется 2 еды. Но когда ты считаешь превышение в MealsUtil тебе нужно суммарное колличество калорий всей еды за день . Поэтому мы достаем сначала по дате , считаем корректное превышение калорий  и фильтруем потом уже по времени

Max   [1 month ago]
@ILYA так это же не важно, мы же в любом случае в методе в MelasUtil отправляем туда весь список целиком, переводим из Meal в MealTo (считаем превышение) и только потом фильтруем. Т.е. в предложенной реализации берется целый список Meal, потом фильтруется по дате, потом методами из MealsUtil преобразуется в список MealTo и уже потом фильтруется по времени. А у меня берется список Meal, преобразуется в MealTo и потом сразу фильтруется сначала по дате, потом по времени. Результат один и тот же, но кода намного меньше и намного понятнее.

tolik1106   [1 month ago]
Ты сделал реализацию в которой фильтруется весь список по дате и времени. А у Григория сначала получает список еды отфильтрованный по дате и уже в контроллере делает трансфер в MealTo с фильтрацией по времени

Max   [1 month ago]
@tolik1106 да, я вот и хочу понять, зачем оно так сделано. Просто выглядит, на мой взгляд, как то жутко неудобно и сложно. А результат что у меня, что у Григория, одинаковый. На вход передаем одно и то же и на выходе получаем одно и то же.

Story   [1 month ago]
@MAX, представьте что у вас очень-очень много записей, человек вел пищевой дневник несколько лет. не оптимально их всех сортировать и конвертировать в другой тип, если вам нужны только записи за конкретных несколько дат. Прежде чем что-то делать над данными, всегда надо максимально уменьшить их количество.

ILYA   [1 month ago]
@Max представь тебе нужно нужно получить еду за 1 день. Зачем тогда из базы данных получать все записи которых может быть много. Когда можно  достать из бд  записи только за один день. Нужно стараться максимально уменьшить нагрузку на бд

Max   [1 month ago]
@Story а, да, теперь все ясно, не подумал об этом. Спасибо большое.

Grigory Kislin   [1 month ago]
можно сделать сначала по дате, затем по времени
но тут я уже учитываю, что мы будем работать с БД и там фильтрация по датам будет вестись в базе. те заранее сделал (edited)


Nikolai Dvinin   [Feb 27th at 11:50 AM]
Всем привет! Вопрос по Logback, в файле logback.xml указываем путь к файлу лога, интересует откуда подтягивается это ${TOPJAVA_ROOT} ?
3 replies

Nikolai Dvinin   [1 month ago]
т.к. у меня файл лога сохранился вот так:
Logback.JPG 

Nikolai Dvinin   [1 month ago]
кажется нашел, должен быть еще проперти, наподобие этого: <property name="DEV_HOME" value="c:/logs" />

Igor   [1 month ago]
Может это?: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson01.md#apply-1_7_loggingpatch
Установите переменную окружения на TOPJAVA_ROOT на корень проекта и перезапустите IDEA. Слеши в пути должны быть в стиле unix (/)


Alena   [Mar 6th at 11:19 AM]
@Grigory Kislin В п. 4.2 "... принимаем в методах сервиса и репозитория параметр userId: id владельца еды. ..."
Это означает, что все методы с едой имеют по 2 параметра?
:
Meal save(Meal meal, int userId)
1 reply

TheMescaline   [27 days ago]
во все методы передается доп параметр int userId, чтобы можно было организовать логику запрета доступа к чужой еде


Alena   [Mar 6th at 11:32 AM]
@Grigory Kislin В п. 4.1 "... Нельзя позволять модифицировать/смотреть чужую еду."
если пользователь не увидит (на странице браузера) чужой еды, то он не сможет её модифицировать; значит достаточно ограничить доступ к просмотру чужой еды?
2 replies

Bahis   [27 days ago]
Нет. Можно запрос подделать.

Grigory Kislin   [27 days ago]
@Alena в уроке же и в ДЗ все несколько раз жуется... почитайте перед вопросом


Wladimir [12:59 PM]
Привет всем ,не знаю может у кого нибудь была такая проблема все тэги в красном не понял из-за чего.
2019-03-27_11-55.png 


Wladimir   [Mar 27th at 2:03 PM]
хотя все в принципе работаает
2 replies

Grigory Kislin   [6 days ago]
1. refresh maven
2. перегрузи idea
3. пересоздай проект

Wladimir   [5 days ago]
хорошо, рефреш не помог. надо пересоздать проект. я об этом уже тоже думал.